---

- name: create tmp dir
  file:
    group: "{{ oracle_group }}"
    owner: "{{ oracle_user }}"
    path: "{{ oracle_tmp }}"
    state: directory
    recurse: yes

- include_tasks: execute_opatch.yml

- name: Run datapatch
  become: yes
  become_user: "{{ oracle_user }}"
  environment: "{{ ora_user_env }}"
  command: $OPATCHDIR/datapatch -verbose
  register: datapatch
  when: patch_type == 'ORACLE'